# üöÄ Git Hooks com Subdom√≠nios Separados - Hostinger

## üìã **VIS√ÉO GERAL**

Este guia apresenta a configura√ß√£o de **Git Hooks para subdom√≠nios separados**:

- **API**: `api-hom.virtualt.com.br` (Laravel)
- **Frontend**: `app-hom.virtualt.com.br` (React)

---

## üéØ **ESTRUTURA DE SUBDOM√çNIOS**

### **Configura√ß√£o dos Subdom√≠nios**

```
virtualt.com.br/
‚îú‚îÄ‚îÄ api-hom.virtualt.com.br/     # Backend Laravel
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ bootstrap/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ vendor/
‚îÇ   ‚îú‚îÄ‚îÄ .env
‚îÇ   ‚îú‚îÄ‚îÄ .htaccess
‚îÇ   ‚îî‚îÄ‚îÄ index.php
‚îî‚îÄ‚îÄ app-hom.virtualt.com.br/     # Frontend React
    ‚îú‚îÄ‚îÄ index.html
    ‚îú‚îÄ‚îÄ assets/
    ‚îú‚îÄ‚îÄ .htaccess
    ‚îî‚îÄ‚îÄ [arquivos buildados]
```

---

## üîß **PASSO A PASSO - SUBDOM√çNIOS**

### **PASSO 1: Configurar Subdom√≠nios na Hostinger**

1. **Acessar Painel Hostinger**

   - Painel ‚Üí Dom√≠nios ‚Üí virtualt.com.br
   - Subdom√≠nios ‚Üí Adicionar Subdom√≠nio

2. **Criar Subdom√≠nio API**

   - Nome: `api-hom`
   - Diret√≥rio: `api-hom.virtualt.com.br`
   - Document Root: `/home/usuario/api-hom.virtualt.com.br`

3. **Criar Subdom√≠nio App**
   - Nome: `app-hom`
   - Diret√≥rio: `app-hom.virtualt.com.br`
   - Document Root: `/home/usuario/app-hom.virtualt.com.br`

### **PASSO 2: Verificar Status do Git (IMPORTANTE)**

**‚ö†Ô∏è ANTES de configurar, verifique se j√° existe um diret√≥rio .git:**

```bash
# 1. Upload do script de verifica√ß√£o
scp scripts/check-git-status.sh usuario@virtualt.com.br:~/

# 2. Acessar servidor
ssh usuario@virtualt.com.br

# 3. Executar verifica√ß√£o
chmod +x check-git-status.sh
./check-git-status.sh
```

**O script ir√°:**

- ‚úÖ Verificar se existe um .git
- ‚úÖ Identificar se √© do projeto correto
- ‚úÖ Mostrar configura√ß√£o atual
- ‚úÖ Oferecer op√ß√µes de limpeza/backup
- ‚úÖ Permitir decis√£o segura

### **PASSO 3: Prepara√ß√£o Local**

```bash
# 1. Verificar estrutura do projeto
ls -la
# Deve mostrar: backend/, frontend/, scripts/

# 2. Preparar arquivos .env para subdom√≠nios
cd backend
cp .env.example .env.production
nano .env.production
# Configurar:
# APP_ENV=production
# APP_DEBUG=false
# APP_URL=https://api-hom.virtualt.com.br
# DB_HOST=localhost
# DB_DATABASE=seu_banco
# DB_USERNAME=seu_usuario
# DB_PASSWORD=sua_senha
cd ..

cd frontend
cp .env.example .env.production
nano .env.production
# Configurar:
# VITE_API_URL=https://api-hom.virtualt.com.br
# VITE_APP_URL=https://app-hom.virtualt.com.br
cd ..
```

### **PASSO 4: Upload e Configura√ß√£o**

```bash
# 1. Upload do script espec√≠fico para subdom√≠nios
scp scripts/setup-git-hooks-subdomains.sh usuario@virtualt.com.br:~/

# 2. Upload dos arquivos .env
scp backend/.env.production usuario@virtualt.com.br:~/backend.env
scp frontend/.env.production usuario@virtualt.com.br:~/frontend.env

# 3. Acessar servidor
ssh usuario@virtualt.com.br

# 4. Executar configura√ß√£o (agora com verifica√ß√£o autom√°tica)
chmod +x setup-git-hooks-subdomains.sh
./setup-git-hooks-subdomains.sh
```

**O script agora ir√°:**

- ‚úÖ Verificar se j√° existe um .git
- ‚úÖ Identificar se √© do projeto correto
- ‚úÖ Perguntar se deve sobrescrever (se for outro projeto)
- ‚úÖ Configurar automaticamente se for o projeto correto

### **PASSO 5: Configurar Reposit√≥rio**

```bash
# No servidor
cd ~
git remote set-url origin https://github.com/spsise/rei-do-oleo.git

# Configurar credenciais (se necess√°rio)
git config user.name "Deploy Bot"
git config user.email "deploy@virtualt.com.br"
```

### **PASSO 6: Configurar Ambiente**

```bash
# 1. Configurar backend
mkdir -p api-hom.virtualt.com.br
mv ~/backend.env api-hom.virtualt.com.br/.env
chmod 644 api-hom.virtualt.com.br/.env

# 2. Configurar frontend
mkdir -p app-hom.virtualt.com.br
mv ~/frontend.env app-hom.virtualt.com.br/.env
chmod 644 app-hom.virtualt.com.br/.env
```

### **PASSO 7: Primeiro Deploy**

```bash
# No seu computador local
git add .
git commit -m "üöÄ Setup subdom√≠nios separados"
git push origin hostinger-hom
```

### **PASSO 8: Verificar Deploy**

```bash
# No servidor
tail -f deploy.log

# Verificar estrutura
ls -la api-hom.virtualt.com.br/
ls -la app-hom.virtualt.com.br/

# Testar subdom√≠nios
./check-subdomains.sh
```

---

## üîß **CONFIGURA√á√ïES ESPEC√çFICAS**

### **Backend Laravel (.env)**

```env
APP_NAME="Rei do √ìleo API"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://api-hom.virtualt.com.br

DB_CONNECTION=mysql
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=rei_do_oleo_hom
DB_USERNAME=seu_usuario
DB_PASSWORD=sua_senha

CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_CONNECTION=sync

# CORS para subdom√≠nios
CORS_ALLOWED_ORIGINS=https://app-hom.virtualt.com.br
```

### **Frontend React (.env)**

```env
VITE_API_URL=https://api-hom.virtualt.com.br
VITE_APP_NAME="Rei do √ìleo"
VITE_APP_URL=https://app-hom.virtualt.com.br
VITE_APP_ENV=homologation
```

---

## üîí **CONFIGURA√á√ïES DE SEGURAN√áA**

### **API .htaccess (api-hom.virtualt.com.br)**

```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^ index.php [L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Access-Control-Allow-Origin "https://app-hom.virtualt.com.br"
Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
```

### **Frontend .htaccess (app-hom.virtualt.com.br)**

```apache
RewriteEngine On

# Handle React Router
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [QSA,L]

# Security headers
Header always set X-Content-Type-Options nosniff
Header always set X-Frame-Options DENY
Header always set X-XSS-Protection "1; mode=block"
Header always set Referrer-Policy "strict-origin-when-cross-origin"

# Cache static assets
<FilesMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
    ExpiresActive On
    ExpiresDefault "access plus 1 year"
    Header set Cache-Control "public, immutable"
</FilesMatch>
```

---

## üß™ **TESTE DOS SUBDOM√çNIOS**

### **1. Teste da API**

```bash
# Testar se a API  responde
curl -I https://api-hom.virtualt.com.br

# Testar endpoint espec√≠fico
curl https://api-hom.virtualt.com.br/api/health

# Testar CORS
curl -H "Origin: https://app-hom.virtualt.com.br" \
     -H "Access-Control-Request-Method: GET" \
     -H "Access-Control-Request-Headers: X-Requested-With" \
     -X OPTIONS https://api-hom.virtualt.com.br/api/health
```

### **2. Teste do Frontend**

```bash
# Testar se o frontend carrega
curl -I https://app-hom.virtualt.com.br

# Verificar se os assets carregam
curl -I https://app-hom.virtualt.com.br/assets/index-*.js
```

### **3. Teste de Integra√ß√£o**

```bash
# No navegador, acessar:
# https://app-hom.virtualt.com.br
# Verificar se consegue fazer requisi√ß√µes para a API
```

---

## üö® **TROUBLESHOOTING - SUBDOM√çNIOS**

### **Problema 1: CORS Error**

```bash
# Verificar configura√ß√£o CORS no Laravel
cd ~/api-hom.virtualt.com.br
nano config/cors.php

# Adicionar:
'allowed_origins' => ['https://app-hom.virtualt.com.br'],
'allowed_methods' => ['*'],
'allowed_headers' => ['*'],
```

### **Problema 2: Subdom√≠nio n√£o responde**

```bash
# Verificar configura√ß√£o na Hostinger
# Painel ‚Üí Dom√≠nios ‚Üí Subdom√≠nios
# Verificar se o Document Root est√° correto

# Verificar permiss√µes
chmod -R 755 ~/api-hom.virtualt.com.br
chmod -R 755 ~/app-hom.virtualt.com.br
```

### **Problema 3: API n√£o carrega**

```bash
# Verificar .htaccess da API
cat ~/api-hom.virtualt.com.br/.htaccess

# Verificar logs do Laravel
tail -f ~/api-hom.virtualt.com.br/storage/logs/laravel.log

# Verificar permiss√µes do storage
chmod -R 755 ~/api-hom.virtualt.com.br/storage
chmod -R 755 ~/api-hom.virtualt.com.br/bootstrap/cache
```

### **Problema 4: Frontend n√£o carrega**

```bash
# Verificar se o build foi gerado
ls -la ~/app-hom.virtualt.com.br/

# Verificar .htaccess do frontend
cat ~/app-hom.virtualt.com.br/.htaccess

# Verificar se o VITE_API_URL est√° correto
cat ~/app-hom.virtualt.com.br/.env
```

### **Problema 5: Conflito com .git existente**

```bash
# Executar script de verifica√ß√£o
./check-git-status.sh

# Ou verificar manualmente
ls -la ~/.git
cat ~/.git/config

# Se for outro projeto, fazer backup e limpar
mkdir ~/git-backup
cp -r ~/.git ~/git-backup/
rm -rf ~/.git
```

---

## üìä **MONITORAMENTO**

### **Script de Verifica√ß√£o**

```bash
# Executar verifica√ß√£o autom√°tica
./check-subdomains.sh
```

### **Logs de Deploy**

```bash
# Logs do deploy
tail -f ~/deploy.log

# Logs do Laravel
tail -f ~/api-hom.virtualt.com.br/storage/logs/laravel.log
```

### **Health Check**

```bash
# Verificar status dos subdom√≠nios
curl -f https://api-hom.virtualt.com.br/api/health || echo "API com problema"
curl -f https://app-hom.virtualt.com.br || echo "Frontend com problema"
```

---

## üîÑ **COMANDOS √öTEIS**

### **Deploy Manual**

```bash
# No servidor
cd ~
./deploy.sh
```

### **Verificar Status**

```bash
# Script de verifica√ß√£o
./check-subdomains.sh
```

### **Rollback**

```bash
# Ver commits recentes
cd ~
git log --oneline -5

# Fazer rollback
git reset --hard COMMIT_ID
```

---

## ‚úÖ **CHECKLIST - SUBDOM√çNIOS**

- [ ] ‚úÖ Subdom√≠nios criados na Hostinger
- [ ] ‚úÖ Document Root configurado corretamente
- [ ] ‚úÖ Status do Git verificado (check-git-status.sh)
- [ ] ‚úÖ Script de configura√ß√£o executado
- [ ] ‚úÖ Reposit√≥rio configurado
- [ ] ‚úÖ Arquivos .env configurados
- [ ] ‚úÖ Primeiro deploy realizado
- [ ] ‚úÖ API respondendo em api-hom.virtualt.com.br
- [ ] ‚úÖ Frontend carregando em app-hom.virtualt.com.br
- [ ] ‚úÖ CORS configurado corretamente
- [ ] ‚úÖ Deploy autom√°tico funcionando

---

## üéâ **RESULTADO FINAL**

Ap√≥s a configura√ß√£o, voc√™ ter√°:

‚úÖ **API Laravel** rodando em `https://api-hom.virtualt.com.br`
‚úÖ **Frontend React** rodando em `https://app-hom.virtualt.com.br`
‚úÖ **Deploy autom√°tico** no `git push origin hostinger-hom`
‚úÖ **CORS configurado** entre os subdom√≠nios
‚úÖ **Build otimizado** para produ√ß√£o
‚úÖ **Backup autom√°tico** antes do deploy
‚úÖ **Logs detalhados** do processo

**üöÄ Seu sistema de deploy automatizado com subdom√≠nios separados est√° pronto!**

---

## üìñ **DOCUMENTA√á√ÉO RELACIONADA**

- üìñ **Guia Detalhado**: `docs/GIT_HOOKS_SETUP.md`
- üöÄ **Script de Configura√ß√£o**: `scripts/setup-git-hooks-subdomains.sh`
- üîç **Script de Verifica√ß√£o**: `scripts/verify-setup.sh`
- üîç **Script de Status Git**: `scripts/check-git-status.sh`
