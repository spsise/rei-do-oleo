# üîÑ Fluxo de Atualiza√ß√£o de Servi√ßo - Documenta√ß√£o Completa

## üìã √çndice

1. [Vis√£o Geral](#vis√£o-geral)
2. [Arquitetura do Sistema](#arquitetura-do-sistema)
3. [Fluxo Frontend](#fluxo-frontend)
4. [Fluxo Backend](#fluxo-backend)
5. [Campos e Dados](#campos-e-dados)
6. [Processo de Valida√ß√£o](#processo-de-valida√ß√£o)
7. [Cache e Sincroniza√ß√£o](#cache-e-sincroniza√ß√£o)
8. [Tratamento de Erros](#tratamento-de-erros)
9. [Exemplos Pr√°ticos](#exemplos-pr√°ticos)

---

## üéØ Vis√£o Geral

O processo de atualiza√ß√£o de servi√ßo √© dividido em duas etapas principais:

1. **Atualiza√ß√£o dos dados do servi√ßo** (informa√ß√µes gerais)
2. **Atualiza√ß√£o dos itens do servi√ßo** (produtos/pe√ßas)

Este fluxo garante consist√™ncia dos dados e permite atualiza√ß√µes granulares.

---

## üèóÔ∏è Arquitetura do Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    HTTP PUT     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    Database    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Frontend      ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Backend       ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ   Database      ‚îÇ
‚îÇ   (React)       ‚îÇ                 ‚îÇ   (Laravel)     ‚îÇ                 ‚îÇ   (MySQL)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                                   ‚îÇ                                   ‚îÇ
        ‚îÇ                                   ‚îÇ                                   ‚îÇ
        ‚ñº                                   ‚ñº                                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ EditServiceModal‚îÇ                 ‚îÇ ServiceController‚îÇ                 ‚îÇ services table  ‚îÇ
‚îÇ TechnicianPage  ‚îÇ                 ‚îÇ ServiceRepository‚îÇ                 ‚îÇ service_items   ‚îÇ
‚îÇ useUpdateService‚îÇ                 ‚îÇ ServiceService   ‚îÇ                 ‚îÇ products table  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## ‚öõÔ∏è Fluxo Frontend

### 1. **Inicializa√ß√£o do Modal de Edi√ß√£o**

**Arquivo**: `frontend/src/components/Technician/EditServiceModal.tsx`

```typescript
// Dados iniciais carregados do servi√ßo
const originalServiceData = useMemo(() => {
  if (!service) return {};

  const completeService = serviceDetails || service;

  return {
    client_id: 0,
    vehicle_id: vehicles.length > 0 ? vehicles[0].id : 0,
    service_center_id: isCompleteService(completeService)
      ? completeService.service_center?.id || 1
      : 1,
    technician_id: isCompleteService(completeService)
      ? completeService.technician?.id || 1
      : 1,
    attendant_id: isCompleteService(completeService)
      ? completeService.attendant?.id || 1
      : 1,
    service_number: service.service_number,
    description: service.description || '',
    estimated_duration: 60,
    scheduled_at: isCompleteService(completeService)
      ? completeService.scheduled_date
      : undefined,
    started_at: isCompleteService(completeService)
      ? completeService.started_at
      : undefined,
    completed_at: isCompleteService(completeService)
      ? completeService.finished_at
      : undefined,
    service_status_id: isCompleteService(completeService)
      ? completeService.status?.id || 1
      : 1,
    payment_method_id: isCompleteService(completeService)
      ? completeService.payment_method?.id || 1
      : 1,
    mileage_at_service: isCompleteService(completeService)
      ? completeService.vehicle?.mileage_at_service
      : service.mileage_at_service || 0,
    total_amount: isCompleteService(completeService)
      ? parseFloat(completeService.financial?.total_amount)
      : service.total_amount || 0,
    discount_amount: isCompleteService(completeService)
      ? completeService.financial?.discount || 0
      : 0,
    final_amount: isCompleteService(completeService)
      ? parseFloat(completeService.financial?.total_amount)
      : service.total_amount || 0,
    observations: isCompleteService(completeService)
      ? completeService.observations
      : service.observations || '',
    notes: isCompleteService(completeService)
      ? completeService.internal_notes
      : service.notes || '',
    active: true,
    items: service.items || [],
  };
}, [service, serviceDetails, vehicles]);
```

### 2. **Manipula√ß√£o de Produtos**

#### **Adicionar Produto**

```typescript
const handleAddProduct = (
  product: TechnicianProduct,
  quantity: number = 1,
  notes?: string
) => {
  setEditData((prev) => {
    if (!prev) return null;

    // Verificar se o produto j√° existe
    const existingItem = prev.items?.find(
      (item) => item.product_id === product.id
    );

    if (existingItem) {
      // Atualizar quantidade se j√° existir
      return {
        ...prev,
        items:
          prev.items?.map((item) =>
            item.product_id === product.id
              ? {
                  ...item,
                  quantity: (item.quantity || 0) + quantity,
                  total_price:
                    (item.unit_price || 0) * ((item.quantity || 0) + quantity),
                }
              : item
          ) || [],
      };
    }

    // Adicionar novo produto
    const newItem: TechnicianServiceItem = {
      id: `item-${service?.id || 'new'}-${product.id}-${Date.now()}`,
      product_id: product.id,
      product: product,
      quantity,
      unit_price: product.price || 0,
      total_price: (product.price || 0) * quantity,
      notes: notes || '',
    };

    return {
      ...prev,
      items: [...(prev.items || []), newItem],
    };
  });
};
```

#### **Atualizar Quantidade**

```typescript
const handleUpdateProductQuantity = (itemId: string, quantity: number) => {
  const validQuantity = Math.max(1, Math.min(quantity, 999));

  setEditData((prev) => {
    if (!prev) return null;

    return {
      ...prev,
      items:
        prev.items?.map((item) =>
          item.id === itemId
            ? {
                ...item,
                quantity: validQuantity,
                total_price: (item.unit_price || 0) * validQuantity,
              }
            : item
        ) || [],
    };
  });
};
```

#### **Atualizar Pre√ßo**

```typescript
const handleUpdateProductPrice = (itemId: string, unitPrice: number) => {
  setEditData((prev) => {
    if (!prev) return null;

    return {
      ...prev,
      items:
        prev.items?.map((item) =>
          item.id === itemId
            ? {
                ...item,
                unit_price: unitPrice,
                total_price: (item.quantity || 0) * unitPrice,
              }
            : item
        ) || [],
    };
  });
};
```

### 3. **C√°lculo de Totais**

```typescript
const handleCalculateItemsTotal = () => {
  const total =
    editData?.items?.reduce((total, item) => {
      const itemTotal = (item.unit_price || 0) * (item.quantity || 0);
      return total + itemTotal;
    }, 0) || 0;
  return isNaN(total) ? 0 : total;
};

const handleCalculateFinalTotal = () => {
  const itemsTotal = handleCalculateItemsTotal();
  const discount = editData?.discount_amount || 0;
  const finalTotal = Math.max(0, itemsTotal - discount);
  return isNaN(finalTotal) ? 0 : finalTotal;
};
```

### 4. **Submiss√£o dos Dados**

**Arquivo**: `frontend/src/pages/Technician.tsx`

```typescript
const handleEditServiceSubmit = async (
  serviceId: number,
  data: EditServiceData
) => {
  try {
    // Separar dados do servi√ßo dos itens
    const { items, ...serviceData } = data;

    // Atualizar o servi√ßo
    await updateServiceMutation.mutateAsync({
      id: serviceId,
      data: serviceData,
    });

    // Aguardar para garantir que a primeira transa√ß√£o foi commitada
    await new Promise((resolve) => setTimeout(resolve, 200));

    // Atualizar os itens do servi√ßo
    await updateServiceItemsMutation.mutateAsync({
      serviceId,
      items: items || [],
    });

    setShowEditServiceModal(false);
    setSelectedServiceForEdit(null);

    // Invalidar cache
    queryClient.invalidateQueries({
      queryKey: [QUERY_KEYS.SERVICE, serviceId],
    });

    queryClient.invalidateQueries({
      queryKey: ['technician', 'search'],
    });

    toast.success('Servi√ßo atualizado com sucesso!');
  } catch (error) {
    console.error('Erro ao editar servi√ßo:', error);
    toast.error('Erro ao salvar altera√ß√µes do servi√ßo');
  }
};
```

---

## üêò Fluxo Backend

### 1. **Rota da API**

**Arquivo**: `backend/routes/api.php`

```php
Route::put('/services/{id}', [ServiceController::class, 'update']);
Route::put('/service-items/{serviceId}/bulk-update', [ServiceItemController::class, 'bulkUpdate']);
```

### 2. **Controller de Servi√ßo**

**Arquivo**: `backend/app/Http/Controllers/Api/ServiceController.php`

```php
public function update(UpdateServiceRequest $request, int $id): JsonResponse
{
    try {
        $validated = $request->validated();

        $service = $this->serviceService->updateService($id, $validated);

        if (!$service) {
            return $this->errorResponse('Service not found', 404);
        }

        return $this->successResponse(
            new ServiceResource($service),
            'Service updated successfully'
        );
    } catch (Exception $e) {
        return $this->errorResponse('Error updating service', 500);
    }
}
```

### 3. **Valida√ß√£o de Dados**

**Arquivo**: `backend/app/Http/Requests/Api/Service/UpdateServiceRequest.php`

```php
public function rules(): array
{
    $serviceId = $this->route('id');

    return [
        'service_center_id' => 'sometimes|exists:service_centers,id',
        'client_id' => 'sometimes|exists:clients,id',
        'vehicle_id' => 'sometimes|exists:vehicles,id',
        'service_number' => ['sometimes', 'string', 'max:20', Rule::unique('services')->ignore($serviceId)],
        'description' => 'sometimes|string|min:3|max:500',
        'complaint' => 'nullable|string|max:1000',
        'diagnosis' => 'nullable|string|max:1000',
        'solution' => 'nullable|string|max:1000',
        'scheduled_at' => 'nullable|date',
        'started_at' => 'nullable|date',
        'completed_at' => 'nullable|date',
        'technician_id' => 'nullable|exists:users,id',
        'attendant_id' => 'nullable|exists:users,id',
        'service_status_id' => 'sometimes|exists:service_statuses,id',
        'payment_method_id' => 'nullable|exists:payment_methods,id',
        'mileage_at_service' => 'nullable|integer|min:0',
        'total_amount' => 'nullable|numeric|min:0',
        'discount_amount' => 'nullable|numeric|min:0',
        'final_amount' => 'nullable|numeric|min:0',
        'observations' => 'nullable|string|max:2000',
        'notes' => 'nullable|string|max:1000',
        'active' => 'sometimes|boolean',
        'estimated_duration' => 'nullable|integer|min:15|max:480',
        'priority' => ['nullable', Rule::in(['low', 'normal', 'high', 'urgent'])],
        'items' => 'nullable|array',
        'items.*.product_id' => 'required|exists:products,id',
        'items.*.quantity' => 'required|integer|min:1',
        'items.*.unit_price' => 'required|numeric|min:0',
        'items.*.discount' => 'nullable|numeric|min:0|max:100',
        'items.*.notes' => 'nullable|string|max:500',
    ];
}
```

### 4. **Service Layer**

**Arquivo**: `backend/app/Domain/Service/Services/ServiceService.php`

```php
public function updateService(int $id, array $data): ?Service
{
    $service = $this->serviceRepository->update($id, $data);

    if ($service) {
        $this->clearServiceCaches($service);
    }

    return $service;
}
```

### 5. **Repository Layer**

**Arquivo**: `backend/app/Domain/Service/Repositories/ServiceRepository.php`

```php
public function update(int $id, array $data): ?Service
{
    $service = Service::find($id);

    if (!$service) {
        return null;
    }

    return DB::transaction(function () use ($service, $data) {
        // Filtrar apenas campos que realmente mudaram
        $changedData = $this->filterChangedFields($service, $data);

        // S√≥ atualizar se h√° mudan√ßas
        if (!empty($changedData)) {
            $service->update($changedData);
        }

        // Update service items if provided
        if (isset($data['items']) && is_array($data['items'])) {
            // Remove existing items
            $service->serviceItems()->delete();

            // Add new items
            $this->addServiceItems($service, $data['items']);
        }

        return $service->fresh([
            'client',
            'vehicle',
            'serviceCenter',
            'serviceStatus',
            'serviceItems.product'
        ]);
    });
}

private function filterChangedFields(Service $service, array $data): array
{
    $changedFields = [];

    foreach ($data as $field => $value) {
        // Pular campos especiais como 'items'
        if ($field === 'items') {
            continue;
        }

        // Comparar valores
        if ($service->getAttribute($field) != $value) {
            $changedFields[$field] = $value;
        }
    }

    return $changedFields;
}

public function addServiceItems(Service $service, array $items): void
{
    foreach ($items as $item) {
        ServiceItem::create([
            'service_id' => $service->id,
            'product_id' => $item['product_id'],
            'quantity' => $item['quantity'],
            'unit_price' => $item['unit_price'],
            'discount' => $item['discount'] ?? 0,
            'total_price' => $item['quantity'] * $item['unit_price'] * (1 - ($item['discount'] ?? 0) / 100),
            'notes' => $item['notes'] ?? null,
        ]);
    }

    // Recalculate service totals
    $service->calculateTotals();
}
```

### 6. **Model Layer**

**Arquivo**: `backend/app/Domain/Service/Models/Service.php`

```php
public function calculateTotals(): void
{
    $totalAmount = $this->serviceItems()->sum('total_price');
    $finalAmount = $totalAmount - ($this->discount_amount ?? 0);

    $this->update([
        'total_amount' => $totalAmount,
        'final_amount' => max(0, $finalAmount),
    ]);
}
```

---

## üìä Campos e Dados

### **Dados Enviados do Frontend para o Backend**

#### **1. Dados do Servi√ßo (Primeira Requisi√ß√£o)**

```typescript
interface EditServiceData {
  vehicle_id?: number;
  description?: string;
  estimated_duration?: number;
  scheduled_at?: string;
  mileage_at_service?: number;
  internal_notes?: string;
  observations?: string;
  discount?: number;
  total_amount?: number;
  final_amount?: number;
}
```

#### **2. Dados dos Itens (Segunda Requisi√ß√£o)**

```typescript
interface ServiceItemData {
  product_id: number;
  quantity: number;
  unit_price: number;
  discount?: number;
  notes?: string;
}
```

### **Mapeamento de Campos**

| Campo Frontend       | Campo Backend        | Tipo       | Descri√ß√£o                  |
| -------------------- | -------------------- | ---------- | -------------------------- |
| `vehicle_id`         | `vehicle_id`         | `integer`  | ID do ve√≠culo              |
| `description`        | `description`        | `string`   | Descri√ß√£o do servi√ßo       |
| `estimated_duration` | `estimated_duration` | `integer`  | Dura√ß√£o estimada (minutos) |
| `scheduled_at`       | `scheduled_at`       | `datetime` | Data/hora agendada         |
| `mileage_at_service` | `mileage_at_service` | `integer`  | Quilometragem no servi√ßo   |
| `internal_notes`     | `notes`              | `text`     | Notas internas             |
| `observations`       | `observations`       | `text`     | Observa√ß√µes                |
| `discount`           | `discount_amount`    | `decimal`  | Valor do desconto          |
| `total_amount`       | `total_amount`       | `decimal`  | Total dos itens            |
| `final_amount`       | `final_amount`       | `decimal`  | Total final (com desconto) |

### **Campos dos Itens**

| Campo Frontend | Campo Backend | Tipo      | Descri√ß√£o           |
| -------------- | ------------- | --------- | ------------------- |
| `product_id`   | `product_id`  | `integer` | ID do produto       |
| `quantity`     | `quantity`    | `integer` | Quantidade          |
| `unit_price`   | `unit_price`  | `decimal` | Pre√ßo unit√°rio      |
| `discount`     | `discount`    | `decimal` | Desconto percentual |
| `notes`        | `notes`       | `text`    | Notas do item       |

---

## ‚úÖ Processo de Valida√ß√£o

### **1. Valida√ß√£o Frontend**

- Verifica√ß√£o de campos obrigat√≥rios
- Valida√ß√£o de tipos de dados
- C√°lculo autom√°tico de totais
- Verifica√ß√£o de mudan√ßas antes do envio

### **2. Valida√ß√£o Backend**

- Valida√ß√£o de regras de neg√≥cio
- Verifica√ß√£o de exist√™ncia de registros relacionados
- Valida√ß√£o de permiss√µes
- Sanitiza√ß√£o de dados

### **3. Valida√ß√£o de Banco**

- Constraints de integridade referencial
- Valida√ß√£o de tipos de dados
- Verifica√ß√£o de chaves √∫nicas

---

## üîÑ Cache e Sincroniza√ß√£o

### **1. React Query Cache**

```typescript
// Invalidar cache do servi√ßo espec√≠fico
queryClient.invalidateQueries({
  queryKey: [QUERY_KEYS.SERVICE, serviceId],
});

// Invalidar cache de busca
queryClient.invalidateQueries({
  queryKey: ['technician', 'search'],
});
```

### **2. Backend Cache**

```php
private function clearServiceCaches(Service $service): void
{
    Cache::forget("service_{$service->id}");
    Cache::forget("service_items_{$service->id}");
    Cache::tags(['services'])->flush();
}
```

---

## ‚ö†Ô∏è Tratamento de Erros

### **1. Frontend**

```typescript
try {
  await updateServiceMutation.mutateAsync({ id: serviceId, data: serviceData });
  await updateServiceItemsMutation.mutateAsync({ serviceId, items });
  toast.success('Servi√ßo atualizado com sucesso!');
} catch (error) {
  console.error('Erro ao editar servi√ßo:', error);

  const errorMessage = (error as any)?.response?.data?.message;
  if (errorMessage?.includes('Service not found')) {
    toast.error('Servi√ßo n√£o encontrado. Tente recarregar a p√°gina.');
  } else {
    toast.error('Erro ao salvar altera√ß√µes do servi√ßo');
  }
}
```

### **2. Backend**

```php
try {
    $service = $this->serviceService->updateService($id, $validated);

    if (!$service) {
        return $this->errorResponse('Service not found', 404);
    }

    return $this->successResponse(
        new ServiceResource($service),
        'Service updated successfully'
    );
} catch (ValidationException $e) {
    return $this->errorResponse('Validation failed', 422, $e->errors());
} catch (Exception $e) {
    Log::error('Error updating service', [
        'service_id' => $id,
        'error' => $e->getMessage()
    ]);
    return $this->errorResponse('Error updating service', 500);
}
```

---

## üìù Exemplos Pr√°ticos

### **Exemplo 1: Atualiza√ß√£o Simples**

**Dados Enviados:**

```json
{
  "description": "Troca de √≥leo e filtro - atualizado",
  "observations": "Cliente solicitou √≥leo sint√©tico",
  "mileage_at_service": 50000
}
```

**Processo:**

1. Frontend valida dados
2. Envia requisi√ß√£o PUT para `/api/services/123`
3. Backend valida e atualiza apenas campos alterados
4. Retorna servi√ßo atualizado
5. Frontend atualiza cache e exibe sucesso

### **Exemplo 2: Atualiza√ß√£o com Itens**

**Dados do Servi√ßo:**

```json
{
  "description": "Manuten√ß√£o completa",
  "total_amount": 1500.0,
  "final_amount": 1350.0,
  "discount": 150.0
}
```

**Dados dos Itens:**

```json
[
  {
    "product_id": 5,
    "quantity": 2,
    "unit_price": 89.9,
    "discount": 10.0,
    "notes": "√ìleo sint√©tico premium"
  },
  {
    "product_id": 12,
    "quantity": 1,
    "unit_price": 45.0,
    "discount": 0,
    "notes": "Filtro de √≥leo"
  }
]
```

**Processo:**

1. Frontend calcula totais automaticamente
2. Envia dados do servi√ßo (primeira requisi√ß√£o)
3. Aguarda confirma√ß√£o (200ms)
4. Envia dados dos itens (segunda requisi√ß√£o)
5. Backend recalcula totais baseado nos itens
6. Frontend atualiza cache e exibe sucesso

### **Exemplo 3: Tratamento de Erro**

**Cen√°rio:** Produto n√£o encontrado

**Resposta do Backend:**

```json
{
  "success": false,
  "message": "Product not found",
  "errors": {
    "items.0.product_id": ["The selected product id is invalid."]
  }
}
```

**Tratamento Frontend:**

```typescript
if (errorMessage?.includes('Product not found')) {
  toast.error('Produto n√£o encontrado. Verifique se ainda est√° dispon√≠vel.');
}
```

---

## üîß Configura√ß√µes Importantes

### **1. Timeouts**

```typescript
// Delay entre transa√ß√µes
await new Promise((resolve) => setTimeout(resolve, 200));
```

### **2. Valida√ß√µes**

```php
// Regras de valida√ß√£o
'quantity' => 'required|integer|min:1|max:999',
'unit_price' => 'required|numeric|min:0',
'discount' => 'nullable|numeric|min:0|max:100',
```

### **3. Transa√ß√µes**

```php
// Garantir consist√™ncia
return DB::transaction(function () use ($service, $data) {
    // Opera√ß√µes de banco
});
```

---

## üìã Checklist de Implementa√ß√£o

### **Frontend**

- [ ] Valida√ß√£o de dados antes do envio
- [ ] C√°lculo autom√°tico de totais
- [ ] Tratamento de erros adequado
- [ ] Feedback visual para o usu√°rio
- [ ] Invalida√ß√£o de cache
- [ ] Loading states

### **Backend**

- [ ] Valida√ß√£o de entrada
- [ ] Transa√ß√µes de banco
- [ ] Recalcula√ß√£o de totais
- [ ] Logs de erro
- [ ] Respostas padronizadas
- [ ] Cache invalidation

### **Testes**

- [ ] Testes unit√°rios
- [ ] Testes de integra√ß√£o
- [ ] Testes de valida√ß√£o
- [ ] Testes de erro
- [ ] Testes de performance

---

## üöÄ Melhorias Futuras

1. **Otimiza√ß√£o de Performance**

   - Implementar cache Redis
   - Otimizar queries de banco
   - Lazy loading de dados

2. **Funcionalidades**

   - Hist√≥rico de altera√ß√µes
   - Notifica√ß√µes em tempo real
   - Backup autom√°tico

3. **Seguran√ßa**
   - Rate limiting
   - Valida√ß√£o mais rigorosa
   - Auditoria de mudan√ßas

---

**üìñ Esta documenta√ß√£o deve ser atualizada sempre que houver mudan√ßas no fluxo de atualiza√ß√£o de servi√ßos.**
